<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grey Space Intelligence – Admin</title>

    <link rel="stylesheet" href="styles/main.css">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet" />

    <style>
        body {
            background-color: #050509;
            color: #f5f5f5;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
        }

        .admin-wrapper {
            max-width: 1200px;
            margin: 80px auto 40px;
            padding: 0 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .admin-header h1 {
            font-size: 1.4rem;
            letter-spacing: 0.12em;
        }

        .admin-status {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: 360px 1fr;
            gap: 24px;
        }

        .admin-tabs {
            display: inline-flex;
            border: 1px solid #2b3040;
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 14px;
        }

        .admin-tab {
            border: none;
            background: #0c0f15;
            color: #d2d7e2;
            padding: 8px 14px;
            font-size: 0.75rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
        }

        .admin-tab.active {
            background: #16203a;
            color: #fff;
        }

        .admin-list-controls {
            display: grid;
            gap: 8px;
            margin-bottom: 10px;
        }

        .admin-card {
            background: #0b0b12;
            border: 1px solid #1b1b26;
            border-radius: 10px;
            padding: 16px 18px;
        }

        .admin-card h2 {
            font-size: 0.95rem;
            margin-bottom: 12px;
            letter-spacing: 0.08em;
        }

        .admin-card label {
            display: block;
            font-size: 0.8rem;
            margin-top: 10px;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .admin-card input,
        .admin-card textarea,
        .admin-card select {
            width: 100%;
            background: #050509;
            border: 1px solid #26263a;
            border-radius: 6px;
            padding: 8px 10px;
            color: #f5f5f5;
            font-size: 0.85rem;
        }

        .admin-card textarea {
            min-height: 70px;
            resize: vertical;
        }

        .admin-row {
            display: flex;
            gap: 10px;
        }

        .admin-row > div {
            flex: 1;
        }

        .admin-actions {
            margin-top: 14px;
            display: flex;
            gap: 10px;
        }

        .admin-subsection {
            margin-top: 12px;
            padding: 10px;
            border: 1px solid #1b1b26;
            border-radius: 8px;
            background: #080913;
        }

        .admin-subsection h3 {
            margin: 0 0 8px;
            font-size: 0.78rem;
            letter-spacing: 0.1em;
            opacity: 0.85;
        }

        .field-help {
            margin-top: 3px;
            font-size: 0.72rem;
            opacity: 0.65;
        }

        .accordion {
            margin-top: 12px;
            border: 1px solid #1b1f29;
            border-radius: 8px;
            overflow: hidden;
        }

        .accordion > summary {
            cursor: pointer;
            list-style: none;
            padding: 10px 12px;
            background: #0c1018;
            border-bottom: 1px solid #1b1f29;
            letter-spacing: 0.08em;
            font-size: 0.76rem;
            text-transform: uppercase;
            color: #d5dae5;
        }

        .accordion > summary::-webkit-details-marker {
            display: none;
        }

        .accordion-content {
            padding: 10px 12px 12px;
        }

        #briefPinsMap {
            width: 100%;
            height: 200px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #1b1b26;
            margin-top: 8px;
        }

        .pins-list {
            margin-top: 10px;
            display: grid;
            gap: 8px;
        }

        .pin-row {
            border: 1px solid #1b1b26;
            border-radius: 8px;
            padding: 8px;
            background: #090b11;
        }

        .pin-row__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.75rem;
            opacity: 0.82;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
            border-radius: 999px;
            padding: 8px 14px;
            font-size: 0.8rem;
            border: 1px solid transparent;
            cursor: pointer;
            letter-spacing: 0.08em;
        }

        .btn-primary {
            background: #f97316;
            border-color: #f97316;
            color: #050509;
        }

        .btn-secondary {
            background: transparent;
            border-color: #3b3b4f;
            color: #f5f5f5;
        }

        .btn-danger {
            background: transparent;
            border-color: #ef4444;
            color: #ef4444;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: default;
        }

        .intel-list {
            max-height: 420px;
            overflow-y: auto;
            margin-top: 8px;
            border-top: 1px solid #1b1b26;
        }

        .intel-item {
            padding: 8px 0;
            border-bottom: 1px solid #14141f;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .intel-item-main {
            flex: 1;
        }

        .intel-item-title {
            font-size: 0.85rem;
        }

        .intel-item-meta {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        #adminMap {
            width: 100%;
            height: 260px;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 8px;
        }

        .login-panel {
            max-width: 360px;
            margin: 120px auto 0;
            background: #0b0b12;
            border-radius: 10px;
            border: 1px solid #1b1b26;
            padding: 18px 20px;
        }

        .login-panel h1 {
            font-size: 1rem;
            margin-bottom: 10px;
            letter-spacing: 0.12em;
        }

        .login-panel label {
            display: block;
            font-size: 0.8rem;
            margin-top: 10px;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .login-panel input {
            width: 100%;
            background: #050509;
            border: 1px solid #26263a;
            border-radius: 6px;
            padding: 8px 10px;
            color: #f5f5f5;
            font-size: 0.85rem;
        }

        .login-panel button {
            margin-top: 14px;
            width: 100%;
        }

        .login-error {
            margin-top: 8px;
            font-size: 0.75rem;
            color: #f97373;
        }

        .login-hint {
            margin-top: 8px;
            font-size: 0.75rem;
            opacity: 0.7;
        }

        @media (max-width: 1024px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .admin-wrapper {
                margin: 60px auto 24px;
                padding: 0 12px;
            }

            .admin-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .admin-row {
                flex-direction: column;
                gap: 0;
            }

            .admin-actions {
                flex-wrap: wrap;
            }

            .btn-primary,
            .btn-secondary,
            .btn-danger {
                width: 100%;
            }

            #adminMap {
                height: 220px;
            }
        }
    </style>
</head>
<body>

    <!-- HAMBURGER MENU BUTTON -->
    <div class="menu-button" id="menuButton">
        <div class="menu-line"></div>
        <div class="menu-line"></div>
        <div class="menu-line"></div>
    </div>

    <!-- SIDE MENU -->
    <div class="side-menu" id="sideMenu">
        <div class="close-menu" id="closeMenu">✕</div>
        <h3>MENU</h3>
        <ul>
            <li onclick="window.location.href='index.html'">Home</li>
            <li onclick="window.location.href='About.html'">About</li>
            <li onclick="window.location.href='Admin.html'">Admin</li>
        </ul>
    </div>

    <div class="menu-overlay" id="menuOverlay"></div>

    <!-- LOGIN PANEL -->
    <div id="loginView" class="login-panel">
        <h1>ADMIN ACCESS</h1>

        <label for="adminEmail">Email</label>
        <input type="email" id="adminEmail" placeholder="you@example.com">

        <label for="adminPassword">Password</label>
        <input type="password" id="adminPassword" placeholder="••••••••">

        <button class="btn-primary" id="loginButton">SIGN IN</button>

        <div class="login-error" id="loginError"></div>
        <div class="login-hint">Use your Supabase admin email & password.</div>
    </div>

    <!-- ADMIN PANEL -->
    <div id="adminView" class="admin-wrapper" style="display:none;">
        <div class="admin-header">
            <h1>GREY SPACE • ADMIN CONSOLE</h1>
            <div class="admin-status">
                <span id="adminUserEmail"></span> • <a href="#" id="logoutLink" style="color:#f97316;">Sign out</a>
            </div>
        </div>

        <div class="admin-tabs" id="adminModeTabs">
            <button class="admin-tab active" data-mode="events">Events</button>
            <button class="admin-tab" data-mode="documents">Brief Documents</button>
        </div>

        <div class="admin-grid">

            <!-- LEFT: Editor -->
            <div class="admin-card">
                <h2 id="editorModeTitle">LIVE EDITOR</h2>

                <label for="intelTitle">Title</label>
                <input id="intelTitle" type="text" placeholder="Headline">

                <label for="intelSummary">Summary</label>
                <textarea id="intelSummary" placeholder="One or two lines of context"></textarea>

                <label for="intelDetails">Details</label>
                <textarea id="intelDetails" placeholder="Deeper context, implications, sources, etc."></textarea>

                <div class="admin-row">
                    <div>
                        <label for="intelRegion">Region</label>
                        <select id="intelRegion">
                            <option value="">Select…</option>
                            <option>North America</option>
                            <option>South America</option>
                            <option>Europe</option>
                            <option>Middle East</option>
                            <option>Africa</option>
                            <option>Central Asia</option>
                            <option>East Asia</option>
                            <option>South Asia</option>
                            <option>Southeast Asia</option>
                            <option>Oceania</option>
                            <option>Global / Multi-Region</option>
                        </select>
                    </div>
                    <div>
                        <label for="intelCategory">Category</label>
                        <select id="intelCategory">
                            <option value="">Select…</option>
                            <option value="MILITARY">MILITARY</option>
                            <option value="POLITICAL">POLITICAL</option>
                            <option value="ECONOMIC">ECONOMIC</option>
                            <option value="SOCIAL">SOCIAL</option>
                            <option value="GREY SPACE">GREY SPACE</option>
                        </select>
                    </div>
                </div>

                <label for="intelScope">Publish To</label>
                <select id="intelScope">
                    <option value="LIVE">Live</option>
                    <option value="BRIEFING">Briefing Room</option>
                </select>

                <div class="admin-row">
                    <div>
                        <label for="intelTimestamp">Timestamp</label>
                        <input id="intelTimestamp" type="datetime-local">
                    </div>
                    <div>
                        <label for="intelSources">Sources</label>
                        <input id="intelSources" type="text" placeholder="Comma-separated URLs or labels">
                    </div>
                </div>

                <div id="briefingFields" style="display:none;">
                    <div class="admin-subsection">
                        <h3 id="briefingModeHeading">BRIEFING ROOM MODE</h3>
                        <div class="admin-row">
                            <div>
                                <label for="briefingEntryKind">Entry Kind</label>
                                <select id="briefingEntryKind">
                                    <option value="document" selected>Brief Document</option>
                                    <option value="event">Event Brief</option>
                                </select>
                                <div class="field-help" id="entryKindHelper" style="display:none;">Entry kind can't be changed after creation. Create a new item to switch type.</div>
                            </div>
                        </div>
                        <div id="briefDocumentTypeFields" style="display:none;">
                            <div class="admin-row">
                                <div>
                                    <label for="briefDocType">Brief Type</label>
                                    <select id="briefDocType">
                                        <option value="scheduled" selected>Scheduled</option>
                                        <option value="regional">Regional</option>
                                        <option value="special">Special</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="briefDocSubtypeSelect">Subtype</label>
                                    <select id="briefDocSubtypeSelect"></select>
                                </div>
                            </div>
                            <div id="briefDocSubtypeSpecialWrap" style="display:none;">
                                <label for="briefDocSubtypeSpecial">Special Subtype</label>
                                <input id="briefDocSubtypeSpecial" type="text" placeholder="e.g. Election Watch">
                            </div>
                            <label for="briefingTags">Tags (comma-separated)</label>
                            <input id="briefingTags" type="text" placeholder="e.g. sanctions, cyber, election">

                            <div id="briefPinsSection" class="admin-subsection" style="display:none;">
                                <h3>HOTSPOTS</h3>
                                <div class="field-help">Click the map to add a pin. Pins are optional but preferred for brief geography.</div>
                                <div id="briefPinsMap"></div>
                                <div id="briefPinsList" class="pins-list"></div>
                            </div>
                        </div>
                    </div>

                    <div id="eventBriefOnlyFields">
                        <label for="briefingWhyMatters">Why It Matters</label>
                        <textarea id="briefingWhyMatters" placeholder="Strategic implications, affected actors, second-order effects"></textarea>

                        <label for="briefingAssessment">Assessment</label>
                        <textarea id="briefingAssessment" placeholder="Short analyst judgement line"></textarea>
                    </div>

                    <div class="admin-row">
                        <div>
                            <label for="briefingStatus">Status</label>
                            <select id="briefingStatus">
                                <option value="ongoing" selected>ongoing</option>
                                <option value="developing">developing</option>
                                <option value="resolved">resolved</option>
                            </select>
                        </div>
                    </div>

                    <div class="admin-row">
                        <div>
                            <label for="briefingConfidence">Confidence</label>
                            <select id="briefingConfidence">
                                <option value="low">low</option>
                                <option value="medium" selected>medium</option>
                                <option value="high">high</option>
                            </select>
                        </div>
                    </div>

                    <div class="admin-subsection">
                        <h3>INTEL CONTROLS</h3>
                        <div class="admin-row">
                            <div>
                                <label for="briefingImpactLevel">Impact Level</label>
                                <select id="briefingImpactLevel">
                                    <option value="strategic">Strategic</option>
                                    <option value="operational">Operational</option>
                                    <option value="tactical">Tactical</option>
                                    <option value="noise" selected>Noise</option>
                                </select>
                                <div class="field-help">How much this matters (Strategic/Operational/Tactical/Noise)</div>
                            </div>
                            <div>
                                <label for="briefingRisk">Risk Level</label>
                                <select id="briefingRisk">
                                    <option value="high">High</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="low">Low</option>
                                </select>
                                <div class="field-help">Likelihood of escalation (Low/Medium/High)</div>
                            </div>
                        </div>

                        <div class="admin-row">
                            <div>
                                <label for="briefingPriority">Priority Level</label>
                                <select id="briefingPriority">
                                    <option value="high">High</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="low">Low</option>
                                </select>
                                <div class="field-help">Editorial urgency (used for sorting/feature)</div>
                            </div>
                            <div>
                                <label for="briefingZoom">Map zoom</label>
                                <input id="briefingZoom" type="number" step="1" min="1" max="18" value="5">
                            </div>
                        </div>
                    </div>

                    <label for="briefingPoints">Key points (one per line)</label>
                    <textarea id="briefingPoints" placeholder="Point 1&#10;Point 2&#10;Point 3"></textarea>

                    <label for="briefingIndicators">Indicators to Watch (one per line)</label>
                    <textarea id="briefingIndicators" placeholder="Indicator 1&#10;Indicator 2&#10;Indicator 3"></textarea>
                </div>

                <div class="admin-row">
                    <div>
                        <label for="intelLat">Latitude</label>
                        <input id="intelLat" type="number" step="0.000001" placeholder="Click map or type">
                    </div>
                    <div>
                        <label for="intelLng">Longitude</label>
                        <input id="intelLng" type="number" step="0.000001" placeholder="Click map or type">
                    </div>
                </div>

                <label for="citySearch">City search</label>
                <input id="citySearch" type="text" placeholder="Type a city name and press Enter">

                <div id="adminMap"></div>

                <div class="admin-actions">
                    <button class="btn-primary" id="publishButton">PUBLISH / UPDATE</button>
                    <button class="btn-secondary" id="resetFormButton">CLEAR FORM</button>
                    <button class="btn-danger" id="deleteButton" style="display:none;">DELETE</button>
                </div>

                <div id="editorStatus" style="margin-top:8px;font-size:0.75rem;opacity:0.7;"></div>
            </div>

            <!-- RIGHT: Queue -->
            <div class="admin-card">
                <h2 id="queueTitle">LIVE QUEUE</h2>
                <div id="queueSubtitle" class="field-help" style="margin-bottom:8px;">Publishes to Live page and Latest Intel.</div>
                <div class="admin-list-controls">
                    <input type="text" id="adminListSearch" placeholder="Search title...">
                    <div class="admin-row">
                        <div>
                            <select id="adminListRegionFilter">
                                <option value="">All Regions</option>
                            </select>
                        </div>
                        <div>
                            <select id="adminListCategoryFilter">
                                <option value="">All Categories</option>
                                <option value="MILITARY">MILITARY</option>
                                <option value="POLITICAL">POLITICAL</option>
                                <option value="ECONOMIC">ECONOMIC</option>
                                <option value="SOCIAL">SOCIAL</option>
                                <option value="GREY SPACE">GREY SPACE</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="eventsLibraryWrap">
                    <div style="font-size:0.75rem;opacity:0.8;letter-spacing:0.08em;margin:6px 0 4px;">LIVE</div>
                    <div class="intel-list" id="liveIntelList" style="max-height:420px;"></div>
                </div>

                <div id="documentsLibraryWrap" style="display:none;">
                    <div style="font-size:0.75rem;opacity:0.8;letter-spacing:0.08em;margin:6px 0 4px;">SCHEDULED BRIEFS</div>
                    <div class="intel-list" id="scheduledBriefDocsList" style="max-height:140px;"></div>

                    <div style="font-size:0.75rem;opacity:0.8;letter-spacing:0.08em;margin:12px 0 4px;">REGIONAL BRIEFINGS</div>
                    <div class="intel-list" id="regionalBriefDocsList" style="max-height:140px;"></div>

                    <div style="font-size:0.75rem;opacity:0.8;letter-spacing:0.08em;margin:12px 0 4px;">SPECIAL BRIEFS</div>
                    <div class="intel-list" id="specialBriefDocsList" style="max-height:140px;"></div>

                    <div style="font-size:0.75rem;opacity:0.8;letter-spacing:0.08em;margin:12px 0 4px;">EVENT BRIEFS</div>
                    <div class="intel-list" id="briefingEventBriefsList" style="max-height:180px;"></div>
                </div>
            </div>

        </div>
    </div>

    <!-- MAPBOX -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>

    <!-- SUPABASE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

    <!-- CONFIG + ADMIN LOGIC -->
    <script src="scripts/supabaseConfig.js"></script>
    <script src="scripts/regionFrames.js"></script>
    <script src="scripts/menu.js"></script>
    <script src="scripts/Admin.js"></script>

</body>
</html>
