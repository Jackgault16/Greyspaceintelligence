<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grey Space Intelligence – Admin</title>

    <link rel="stylesheet" href="styles/main.css">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet" />

    <style>
        body {
            background-color: #050509;
            color: #f5f5f5;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
        }

        .admin-wrapper {
            max-width: 1200px;
            margin: 80px auto 40px;
            padding: 0 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .admin-header h1 {
            font-size: 1.4rem;
            letter-spacing: 0.12em;
        }

        .admin-status {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .admin-mode-switch {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .admin-mode-switch button {
            padding: 8px 14px;
            border-radius: 6px;
            background: #0b0b12;
            border: 1px solid #26263a;
            color: #f5f5f5;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .admin-mode-switch button.active {
            border-color: #4f7cff;
            background: #111523;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 24px;
        }

        .admin-card {
            background: #0b0b12;
            border: 1px solid #1b1b26;
            border-radius: 10px;
            padding: 16px 18px;
        }

        .admin-card h2 {
            font-size: 0.95rem;
            margin-bottom: 12px;
            letter-spacing: 0.08em;
        }

        .admin-card label {
            display: block;
            font-size: 0.8rem;
            margin-top: 10px;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .admin-card input,
        .admin-card textarea,
        .admin-card select {
            width: 100%;
            background: #050509;
            border: 1px solid #26263a;
            border-radius: 6px;
            padding: 8px 10px;
            color: #f5f5f5;
            font-size: 0.85rem;
        }

        .admin-card textarea {
            min-height: 70px;
            resize: vertical;
        }

        .admin-row {
            display: flex;
            gap: 10px;
        }

        .admin-row > div {
            flex: 1;
        }

        .admin-actions {
            margin-top: 14px;
            display: flex;
            gap: 10px;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
            border-radius: 999px;
            padding: 8px 14px;
            font-size: 0.8rem;
            border: 1px solid transparent;
            cursor: pointer;
            letter-spacing: 0.08em;
        }

        .btn-primary {
            background: #f97316;
            border-color: #f97316;
            color: #050509;
        }

        .btn-secondary {
            background: transparent;
            border-color: #3b3b4f;
            color: #f5f5f5;
        }

        .btn-danger {
            background: transparent;
            border-color: #ef4444;
            color: #ef4444;
        }

        .intel-list {
            max-height: 420px;
            overflow-y: auto;
            margin-top: 8px;
            border-top: 1px solid #1b1b26;
        }

        .intel-item {
            padding: 8px 0;
            border-bottom: 1px solid #14141f;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .intel-item-main {
            flex: 1;
        }

        .intel-item-title {
            font-size: 0.85rem;
        }

        .intel-item-meta {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        #adminMap,
        #br-map {
            width: 100%;
            height: 260px;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 8px;
        }

        .login-panel {
            max-width: 360px;
            margin: 120px auto 0;
            background: #0b0b12;
            border-radius: 10px;
            border: 1px solid #1b1b26;
            padding: 18px 20px;
        }

        .login-panel h1 {
            font-size: 1rem;
            margin-bottom: 10px;
            letter-spacing: 0.12em;
        }

        .login-panel label {
            display: block;
            font-size: 0.8rem;
            margin-top: 10px;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .login-panel input {
            width: 100%;
            background: #050509;
            border: 1px solid #26263a;
            border-radius: 6px;
            padding: 8px 10px;
            color: #f5f5f5;
            font-size: 0.85rem;
        }

        .login-panel button {
            margin-top: 14px;
            width: 100%;
        }

        .login-error {
            margin-top: 8px;
            font-size: 0.75rem;
            color: #f97373;
        }

        .login-hint {
            margin-top: 8px;
            font-size: 0.75rem;
            opacity: 0.7;
        }
    </style>
</head>
<body>

    <!-- HAMBURGER MENU BUTTON -->
    <div class="menu-button" id="menuButton">
        <div class="menu-line"></div>
        <div class="menu-line"></div>
        <div class="menu-line"></div>
    </div>

    <!-- SIDE MENU -->
    <div class="side-menu" id="sideMenu">
        <div class="close-menu" id="closeMenu">✕</div>
        <h3>MENU</h3>
        <ul>
            <li onclick="window.location.href='index.html'">Home</li>
            <li onclick="window.location.href='About.html'">About</li>
            <li onclick="window.location.href='admin.html'">Admin</li>
        </ul>
    </div>

    <div class="menu-overlay" id="menuOverlay"></div>

    <!-- LOGIN PANEL -->
    <div id="loginView" class="login-panel">
        <h1>ADMIN ACCESS</h1>

        <label for="adminEmail">Email</label>
        <input type="email" id="adminEmail" placeholder="you@example.com">

        <label for="adminPassword">Password</label>
        <input type="password" id="adminPassword" placeholder="••••••••">

        <button class="btn-primary" id="loginButton">SIGN IN</button>

        <div class="login-error" id="loginError"></div>
        <div class="login-hint">Use your Supabase admin email & password.</div>
    </div>

    <!-- ADMIN PANEL -->
    <div id="adminView" class="admin-wrapper" style="display:none;">
        <div class="admin-header">
            <h1>GREY SPACE • ADMIN CONSOLE</h1>
            <div class="admin-status">
                <span id="adminUserEmail"></span> • <a href="#" id="logoutLink" style="color:#f97316;">Sign out</a>
            </div>
        </div>

        <!-- MODE SWITCH -->
        <div class="admin-mode-switch">
            <button id="modeLive" class="active">LIVE INTEL</button>
            <button id="modeBriefings">BRIEFING ROOM</button>
        </div>

        <div class="admin-grid">

            <!-- LEFT: EDITOR -->
            <div class="admin-card" id="editorCard">

                <!-- LIVE INTEL EDITOR -->
                <div id="liveEditor">
                    <h2>INTEL EDITOR</h2>

                    <label for="intelTitle">Title</label>
                    <input id="intelTitle" type="text" placeholder="Headline">

                    <label for="intelSummary">Summary</label>
                    <textarea id="intelSummary" placeholder="One or two lines of context"></textarea>

                    <label for="intelDetails">Details</label>
                    <textarea id="intelDetails" placeholder="Deeper context, implications, sources, etc."></textarea>

                    <div class="admin-row">
                        <div>
                            <label for="intelRegion">Region</label>
                            <select id="intelRegion">
                                <option value="">Select…</option>
                                <option>North America</option>
                                <option>South America</option>
                                <option>Europe</option>
                                <option>Middle East</option>
                                <option>Africa</option>
                                <option>Central Asia</option>
                                <option>East Asia</option>
                                <option>South Asia</option>
                                <option>Southeast Asia</option>
                                <option>Oceania</option>
                                <option>Global / Multi-Region</option>
                            </select>
                        </div>
                        <div>
                            <label for="intelCategory">Category</label>
                            <select id="intelCategory">
                                <option value="">Select…</option>
                                <option value="MILITARY">MILITARY</option>
                                <option value="POLITICAL">POLITICAL</option>
                                <option value="ECONOMIC">ECONOMIC</option>
                                <option value="SOCIAL">SOCIAL</option>
                                <option value="GREY SPACE">GREY SPACE</option>
                            </select>
                        </div>
                    </div>

                    <div class="admin-row">
                        <div>
                            <label for="intelTimestamp">Timestamp</label>
                            <input id="intelTimestamp" type="datetime-local">
                        </div>
                        <div>
                            <label for="intelSources">Sources</label>
                            <input id="intelSources" type="text" placeholder="Comma-separated URLs or labels">
                        </div>
                    </div>

                    <div class="admin-row">
                        <div>
                            <label for="intelLat">Latitude</label>
                            <input id="intelLat" type="number" step="0.000001" placeholder="Click map or type">
                        </div>
                        <div>
                            <label for="intelLng">Longitude</label>
                            <input id="intelLng" type="number" step="0.000001" placeholder="Click map or type">
                        </div>
                    </div>

                    <label for="citySearch">City search</label>
                    <input id="citySearch" type="text" placeholder="Type a city name and press Enter">

                    <div id="adminMap"></div>

                    <div class="admin-actions">
                        <button class="btn-primary" id="publishButton">PUBLISH / UPDATE</button>
                        <button class="btn-secondary" id="resetFormButton">CLEAR FORM</button>
                        <button class="btn-danger" id="deleteButton" style="display:none;">DELETE</button>
                    </div>

                    <div id="editorStatus" style="margin-top:8px;font-size:0.75rem;opacity:0.7;"></div>
                </div>

                <!-- BRIEFING ROOM EDITOR -->
                <div id="briefingEditor" style="display:none;">
                    <h2>BRIEFING EDITOR</h2>

                    <label>Title</label>
                    <input id="br-title" type="text" placeholder="Briefing title">

                    <label>Category</label>
                    <select id="br-category">
                        <option value="military">Military</option>
                        <option value="political">Political</option>
                        <option value="economic">Economic</option>
                        <option value="social">Social</option>
                        <option value="greyspace">Grey Space</option>
                    </select>

                    <label>Region</label>
                    <select id="br-region">
                        <option>North America</option>
                        <option>South America</option>
                        <option>Europe</option>
                        <option>Middle East</option>
                        <option>Africa</option>
                        <option>Central Asia</option>
                        <option>East Asia</option>
                        <option>South Asia</option>
                        <option>Southeast Asia</option>
                        <option>Oceania</option>
                        <option>Global / Multi-Region</option>
                    </select>

                    <label>Risk Level</label>
                    <select id="br-risk">
                        <option value="high">High</option>
                        <option value="med">Medium</option>
                        <option value="low">Low</option>
                    </select>

                    <label>Priority</label>
                    <select id="br-priority">
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>

                    <label>Summary</label>
                    <textarea id="br-summary" placeholder="Short summary"></textarea>

                    <label>Bullet Points (one per line)</label>
                    <textarea id="br-points"></textarea>

                    <label>Analysis</label>
                    <textarea id="br-analysis"></textarea>

                    <label>Longitude</label>
                    <input id="br-lng" type="number" step="0.000001">

                    <label>Latitude</label>
                    <input id="br-lat" type="number" step="0.000001">

                    <label>Zoom</label>
                    <input id="br-zoom" type="number" value="5">

                    <label for="br-city-search">City search</label>
                    <input id="br-city-search" type="text" placeholder="Type a city name and press Enter">

                    <div id="br-map"></div>

                    <div class="admin-actions">
                        <button class="btn-primary" id="br-publish">PUBLISH / UPDATE</button>
                        <button class="btn-secondary" id="br-reset">CLEAR FORM</button>
                        <button class="btn-danger" id="br-delete" style="display:none;">DELETE</button>
                    </div>

                    <div id="br-status" style="margin-top:8px;font-size:0.75rem;opacity:0.7;"></div>
                </div>

            </div>

            <!-- RIGHT: LIST -->
            <div class="admin-card">
                <h2 id="listTitle">EXISTING INTEL</h2>
                <div class="intel-list" id="intelList"></div>
            </div>

        </div>
    </div>

    <!-- MAPBOX -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>

    <!-- SUPABASE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

    <!-- CONFIG + ADMIN LOGIC -->
    <script src="scripts/supabaseConfig.js"></script>
    <script src="scripts/admin.js"></script>

    <!-- HAMBURGER MENU FIX -->
    <script>
        const menuButton = document.getElementById("menuButton");
        const sideMenu = document.getElementById("sideMenu");
        const menuOverlay = document.getElementById("menuOverlay");
        const closeMenu = document.getElementById("closeMenu");

        menuButton.addEventListener("click", () => {
            sideMenu.classList.add("open");
            menuOverlay.classList.add("visible");
        });

        closeMenu.addEventListener("click", () => {
            sideMenu.classList.remove("open");
            menuOverlay.classList.remove("visible");
        });

        menuOverlay.addEventListener("click", () => {
            sideMenu.classList.remove("open");
            menuOverlay.classList.remove("visible");
        });
    </script>

</body>
</html>
