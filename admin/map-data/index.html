<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grey Space - Map Data Editor</title>
  <link rel="stylesheet" href="../../styles/main.css">
  <link rel="stylesheet" href="../../styles/admin-map-data.css">
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet" />
</head>
<body>
  <div class="menu-button" id="menuButton">
    <div class="menu-line"></div>
    <div class="menu-line"></div>
    <div class="menu-line"></div>
  </div>

  <div class="side-menu" id="sideMenu">
    <div class="close-menu" id="closeMenu">X</div>
    <h3>MENU</h3>
    <ul>
      <li onclick="window.location.href='../../index.html'">Home</li>
      <li onclick="window.location.href='../../Admin.html'">Admin Hub</li>
      <li onclick="window.location.href='../../map.html'">Map</li>
    </ul>
  </div>
  <div class="menu-overlay" id="menuOverlay"></div>

  <header class="title-header"><h1>GREY SPACE</h1></header>
  <nav class="navbar">
    <ul class="nav-links">
      <li onclick="window.location.href='../../index.html'">HOME</li>
      <li onclick="window.location.href='../../Admin.html'">ADMIN HUB</li>
      <li class="active">MAP DATA</li>
    </ul>
  </nav>

  <main class="map-admin-page">
    <section id="mapAdminLogin" class="card login-card">
      <h2>Map Data Admin</h2>
      <label>Email</label>
      <input id="mapAdminEmail" type="email" placeholder="you@example.com">
      <label>Password</label>
      <input id="mapAdminPassword" type="password" placeholder="********">
      <button id="mapAdminLoginBtn">Sign In</button>
      <div id="mapAdminLoginStatus" class="note"></div>
    </section>

    <section id="mapAdminApp" style="display:none;">
      <div class="head-row">
        <h2>Country Compendium Editor</h2>
        <div><span id="mapAdminUser"></span> â€¢ <a href="#" id="mapAdminLogout">Sign out</a></div>
      </div>

      <div class="top-bar card">
        <div class="country-picker">
          <label for="countryPickerInput">Country</label>
          <input id="countryPickerInput" list="countryOptions" placeholder="Select country...">
          <datalist id="countryOptions"></datalist>
        </div>
        <div class="category-tabs" id="categoryTabs">
          <button data-category="political" class="active">Political</button>
          <button data-category="military">Military</button>
          <button data-category="economic">Economic</button>
          <button data-category="social">Social</button>
          <button data-category="greyspace">Grey Space</button>
        </div>
        <div class="status-box">
          <div class="status-title">Status</div>
          <div id="editorStatusBadge" class="status-pill">Loaded</div>
          <button id="bootstrapWikidataBtn" class="small-btn" style="margin-top:8px;">Bootstrap from Wikidata</button>
        </div>
      </div>

      <div class="editor-grid">
        <aside class="card">
          <h3>Country Overview</h3>
          <div id="overviewCountryName" class="country-title">No country selected</div>
          <div id="overviewCountryMeta" class="note">Select a country to begin.</div>
          <button id="openOnMapBtn" class="ghost-btn">Open on Map</button>

          <h4>POI Counters</h4>
          <div id="categoryCounters" class="counter-grid"></div>

          <details>
            <summary>Country Base Fields</summary>
            <div class="detail-body">
              <div class="row">
                <div><label>ISO2</label><input id="countryIso2" type="text" maxlength="2" readonly></div>
                <div><label>ISO3</label><input id="countryIso3" type="text" maxlength="3"></div>
              </div>
              <label>Name</label><input id="countryName" type="text">
              <div class="row">
                <div><label>Region</label><input id="countryRegion" type="text"></div>
                <div><label>Capital</label><input id="countryCapital" type="text"></div>
              </div>
              <label>Centroid [lng,lat]</label><input id="countryCentroid" type="text" placeholder="12.4, 41.9">
              <label>BBox [west,south,east,north]</label><input id="countryBbox" type="text" placeholder="-10, 35, 30, 72">
              <button id="saveCountryBtn">Save Country</button>
            </div>
          </details>
        </aside>

        <section class="card">
          <h3>Category Editor</h3>
          <div class="note" id="activeCategoryLabel">Political</div>

          <details open>
            <summary>Profile</summary>
            <div class="detail-body">
              <div class="section-head">
                <strong>Metrics</strong>
                <button id="addMetricBtn" class="small-btn">Add Metric</button>
              </div>
              <div id="metricsRows" class="metrics-rows"></div>

              <label>Narrative</label>
              <textarea id="profileNarrative"></textarea>

              <label>Sources (comma-separated)</label>
              <input id="profileSources" type="text">

              <details>
                <summary>Advanced: JSON</summary>
                <div class="detail-body">
                  <textarea id="metricsJson"></textarea>
                  <button id="applyJsonBtn" class="small-btn">Apply JSON to Grid</button>
                </div>
              </details>

              <button id="saveProfileBtn">Save Profile</button>
            </div>
          </details>

          <details open>
            <summary>POIs</summary>
            <div class="detail-body">
              <div class="section-head">
                <strong>POI List</strong>
                <button id="addPoiBtn" class="small-btn">Add POI</button>
              </div>
              <div id="poisTable" class="pois-table"></div>
              <button id="savePoisBtn">Save POI Changes</button>
            </div>
          </details>

          <details open>
            <summary>Preview</summary>
            <div class="detail-body">
              <div id="previewPanel" class="preview-panel">
                <div class="preview-head">
                  <div id="previewCountryName">Country</div>
                  <div id="previewCategory">Political</div>
                </div>
                <div id="previewMetrics" class="preview-metrics"></div>
                <p id="previewNarrative" class="note"></p>
                <div id="previewSources" class="chip-wrap"></div>
                <h5>POIs</h5>
                <div id="previewPois" class="preview-pois"></div>
              </div>
            </div>
          </details>

          <div id="mapAdminStatus" class="note"></div>
        </section>
      </div>
    </section>
  </main>

  <div id="poiModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="poiModalTitle">Add POI</h3>
        <button id="poiModalClose" class="small-btn">Close</button>
      </div>
      <div class="row">
        <div><label>Name</label><input id="poiName" type="text"></div>
        <div><label>Type</label><input id="poiType" type="text"></div>
      </div>
      <div class="row">
        <div><label>Latitude</label><input id="poiLat" type="number" step="0.000001"></div>
        <div><label>Longitude</label><input id="poiLng" type="number" step="0.000001"></div>
      </div>
      <div class="row">
        <div>
          <label>Confidence</label>
          <select id="poiConfidence">
            <option value="low">low</option>
            <option value="medium" selected>medium</option>
            <option value="high">high</option>
          </select>
        </div>
      </div>
      <label>Notes</label><textarea id="poiNotes"></textarea>
      <label>Sources (comma-separated)</label><input id="poiSources" type="text">
      <div id="poiMap" class="poi-map"></div>
      <div class="note">Click map to set latitude/longitude.</div>
      <div class="actions">
        <button id="poiModalSave">Save POI</button>
      </div>
    </div>
  </div>

  <div id="switchConfirmModal" class="modal" aria-hidden="true">
    <div class="modal-card small">
      <h3>Unsaved changes</h3>
      <p class="note">You have unsaved changes. Save or discard?</p>
      <div class="actions">
        <button id="confirmSaveSwitch">Save</button>
        <button id="confirmDiscardSwitch" class="ghost-btn">Discard</button>
        <button id="confirmCancelSwitch" class="ghost-btn">Cancel</button>
      </div>
    </div>
  </div>

  <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
  <script src="../../scripts/supabaseConfig.js"></script>
  <script src="../../scripts/menu.js"></script>
  <script src="../../scripts/admin-map-data.js"></script>
</body>
</html>
